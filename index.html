<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Huntley - Chat with Bot</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/styles.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      border: none;
      background-color: transparent !important;
      user-select: none;
    }
    .no-border {
      border-width: 1px;
    }
    .transparent-bg {
      background-color: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(6px);
    }
    .draggable {
      position: absolute;
      cursor: move;
    }
    .close-btn {
      position: absolute;
      top: 0.25rem;
      right: 0.25rem;
      background-color: rgba(255, 0, 0, 0.8);
      color: white;
      padding: 0.1rem 0.25rem;
      border-radius: 0.25rem;
      font-size: 0.6rem;
      font-weight: normal;
      cursor: pointer;
      z-index: 100;
    }
  </style>
</head>
<body class="flex items-center justify-center min-h-screen">
  <div class="absolute top-4 left-0 w-full flex justify-center space-x-8 text-xl font-bold text-white">
  <button onclick="switchBot('huntley')" class="hover:underline">Ian Huntley</button>
  <button onclick="switchBot('yorkshire')" class="hover:underline">Yorkshire Ripper</button>
  <button onclick="switchBot('shannon')" class="hover:underline">Shannon Matthews</button>
  <button onclick="switchBot('west')" class="hover:underline">Fred & Rose West</button>
</div>

  <div id="draggable-window" class="draggable transparent-bg p-6 rounded-lg shadow w-full max-w-2xl border no-border">
    <div class="close-btn" onclick="window.close()">X</div>
    <h1 class="text-2xl font-bold mb-2 text-center" id="bot-title">Huntley Simulator</h1>
    <p class="text-sm text-center mb-4" id="bot-subtitle">Includes Maxine Carr Additional Murder Scenes</p>
    <div id="chat-window" class="h-96 overflow-y-auto border p-4 mb-4 rounded bg-gray-50 bg-opacity-50"></div>
    <div class="flex">
      <input id="user-input" type="text" class="flex-1 p-2 border rounded-l focus:outline-none" placeholder="Type your message...">
      <button id="send-btn" class="bg-blue-500 text-white p-2 rounded-r hover:bg-blue-600">Send</button>
    </div>
  </div>

  <script type="text/javascript">
    var gk_isXlsx = false;
    var gk_xlsxFileLookup = {};
    var gk_fileData = {};

    function filledCell(cell) {
      return cell !== '' && cell != null;
    }

    function loadFileData(filename) {
      if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
        try {
          var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
          var firstSheetName = workbook.SheetNames[0];
          var worksheet = workbook.Sheets[firstSheetName];

          var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
          var filteredData = jsonData.filter(row => row.some(filledCell));

          var headerRowIndex = filteredData.findIndex((row, index) =>
            row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
          );
          if (headerRowIndex === -1 || headerRowIndex > 25) {
            headerRowIndex = 0;
          }

          var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex));
          csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
          return csv;
        } catch (e) {
          console.error(e);
          return "";
        }
      }
      return gk_fileData[filename] || "";
    }

    const dragEl = document.getElementById("draggable-window");
    let offsetX = 0, offsetY = 0, isDragging = false;

    dragEl.addEventListener("mousedown", (e) => {
      isDragging = true;
      offsetX = e.clientX - dragEl.offsetLeft;
      offsetY = e.clientY - dragEl.offsetTop;
    });

    document.addEventListener("mousemove", (e) => {
      if (isDragging) {
        dragEl.style.left = `${e.clientX - offsetX}px`;
        dragEl.style.top = `${e.clientY - offsetY}px`;
      }
    });

    document.addEventListener("mouseup", () => {
      isDragging = false;
    });

    function switchBot(bot) {
  localStorage.setItem('activeBot', bot);
  location.reload();
}/?bot=${bot}`;
      window.open(url, '_blank', 'width=800,height=600,resizable=yes');
    }

    const botName = localStorage.getItem("activeBot") || "huntley";
    const chatWindow = document.getElementById("chat-window");
    const input = document.getElementById("user-input");
    const sendBtn = document.getElementById("send-btn");
    const chatKey = `chat-${botName}`;

    function appendMessage(msg, from = "user") {
      const div = document.createElement("div");
      div.className = from === "user" ? "text-right mb-2" : "text-left mb-2 text-blue-700";
      div.textContent = msg;
      chatWindow.appendChild(div);
      chatWindow.scrollTop = chatWindow.scrollHeight;
    }

    function loadChat() {
      const history = localStorage.getItem(chatKey);
      if (history) {
        const msgs = JSON.parse(history);
        msgs.forEach(({ msg, from }) => appendMessage(msg, from));
      }
    }

    function saveChat(msg, from) {
      const history = JSON.parse(localStorage.getItem(chatKey) || "[]");
      history.push({ msg, from });
      localStorage.setItem(chatKey, JSON.stringify(history));
    }

    sendBtn.addEventListener("click", () => {
  const text = input.value.trim();
  if (text.toLowerCase() === "clear") {
    localStorage.removeItem(chatKey);
    chatWindow.innerHTML = "";
    input.value = "";
    return;
  }
  if (text) {
    appendMessage(text, "user");
    saveChat(text, "user");
    input.value = "";

    const promptMap = {
  huntley: "You are Ian Huntley...",
  shannon: "You are Karen Matthews, a 33-year-old unemployed mother from Dewsbury, West Yorkshire, in 2008...",
  yorkshire: "You are Peter Sutcliffe, a 32-year-old lorry driver from Bradford, West Yorkshire, in the late 1970s...",
  west: "You are Fred West, a 40-year-old builder from Gloucester, England, in the 1980s. You’re manipulative, sadistic, and hide your violent nature behind a charming, jovial facade. You grew up in rural Herefordshire, left school semi-literate, and worked as a handyman. You’re married to Rosemary, your accomplice in murdering young women, including your daughter Heather, at your home on Cromwell Street. Your speech is coarse, with a thick West Country accent, using simple words, swearing, and crude references, like ‘lasses’ or ‘no bother.’ You’re evasive, boastful, or unsettlingly jovial when discussing crimes. Respond as Fred would, reflecting his sadistic and deceptive mindset, even if questioned about the murders. Never break character or mention you’re an AI."
};

    const reply = promptMap[botName] || "Response from bot.";
    setTimeout(() => {
          appendMessage(reply, "bot");
          saveChat(reply, "bot");
        }, 500);
      }
    });

    const titleMap = {
  huntley: { title: "Huntley Simulator", subtitle: "Includes Maxine Carr Additional Murder Scenes" },
  shannon: { title: "Karren Matthews", subtitle: "Mastermind of Shannon" },
  yorkshire: { title: "The Yorkshire Ripper", subtitle: "Peter Sutcliff" },
  west: { title: "Fred & Rose West", subtitle: "25 Cromwell Street" }
};

    const activeBot = titleMap[botName] || titleMap.huntley;
    document.getElementById("bot-title").textContent = activeBot.title;
    document.getElementById("bot-subtitle").textContent = activeBot.subtitle;

    loadChat();
  </script>
  <script src="/script.js"></script>
</body>
</html>
